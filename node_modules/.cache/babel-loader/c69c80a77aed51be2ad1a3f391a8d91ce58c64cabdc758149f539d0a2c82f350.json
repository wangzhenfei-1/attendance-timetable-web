{"ast":null,"code":"var _s = $RefreshSig$();\n// src/hooks/useTimetable.ts\nimport { useState, useEffect } from 'react';\n/**\n * 按学期 key 读写 localStorage 的 Hook\n * @param semester 当前选中的学期，如 \"2025 前期\"\n */\nexport function useTimetable(semester) {\n  _s();\n  const storageKey = `timetable-${semester}`;\n\n  // 1) 初始化时，从对应 key 读取\n  const [lessons, setLessons] = useState(() => {\n    try {\n      const raw = localStorage.getItem(storageKey);\n      return raw ? JSON.parse(raw) : [];\n    } catch {\n      return [];\n    }\n  });\n\n  // 2) lessons 或 storageKey 变更时写回\n  useEffect(() => {\n    localStorage.setItem(storageKey, JSON.stringify(lessons));\n  }, [lessons, storageKey]);\n\n  // 3) 学期变化时重新加载\n  useEffect(() => {\n    try {\n      const raw = localStorage.getItem(storageKey);\n      setLessons(raw ? JSON.parse(raw) : []);\n    } catch {\n      setLessons([]);\n    }\n  }, [storageKey]);\n  const addLesson = lesson => setLessons(prev => [...prev, lesson]);\n  const updateLesson = lesson => setLessons(prev => prev.map(l => l.id === lesson.id ? lesson : l));\n  const removeLesson = id => setLessons(prev => prev.filter(l => l.id !== id));\n  const getIndicatorColor = lesson => {\n    const ratio = lesson.absences / lesson.required;\n    if (ratio <= 1 / 3) return 'green';\n    if (ratio <= 2 / 3) return 'orange';\n    if (ratio < 1) return 'red';\n    return 'black';\n  };\n  return {\n    lessons,\n    addLesson,\n    updateLesson,\n    removeLesson,\n    getIndicatorColor\n  };\n}\n_s(useTimetable, \"dxQMcsIS7ClgKljuBbv5D50wQ0M=\");","map":{"version":3,"names":["useState","useEffect","useTimetable","semester","_s","storageKey","lessons","setLessons","raw","localStorage","getItem","JSON","parse","setItem","stringify","addLesson","lesson","prev","updateLesson","map","l","id","removeLesson","filter","getIndicatorColor","ratio","absences","required"],"sources":["/Users/wangzhenfei/Projects/attendance-timetable-web/src/hooks/useTimetable.ts"],"sourcesContent":["// src/hooks/useTimetable.ts\nimport { useState, useEffect } from 'react';\n\nexport type Lesson = {\n  id: string;\n  weekday: 0 | 1 | 2 | 3 | 4;      // 月～金\n  period: 1 | 2 | 3 | 4 | 5 | 6;    // 1限～6限\n  title: string;                   // 科目名\n  professor: string;               // 教授名\n  room: string;                    // 教室\n  required: number;                // 必要出席回数\n  color: string;                   // 背景色\n  absences: number;                // 欠席回数\n};\n\n/**\n * 按学期 key 读写 localStorage 的 Hook\n * @param semester 当前选中的学期，如 \"2025 前期\"\n */\nexport function useTimetable(semester: string) {\n  const storageKey = `timetable-${semester}`;\n\n  // 1) 初始化时，从对应 key 读取\n  const [lessons, setLessons] = useState<Lesson[]>(() => {\n    try {\n      const raw = localStorage.getItem(storageKey);\n      return raw ? JSON.parse(raw) : [];\n    } catch {\n      return [];\n    }\n  });\n\n  // 2) lessons 或 storageKey 变更时写回\n  useEffect(() => {\n    localStorage.setItem(storageKey, JSON.stringify(lessons));\n  }, [lessons, storageKey]);\n\n  // 3) 学期变化时重新加载\n  useEffect(() => {\n    try {\n      const raw = localStorage.getItem(storageKey);\n      setLessons(raw ? JSON.parse(raw) : []);\n    } catch {\n      setLessons([]);\n    }\n  }, [storageKey]);\n\n  const addLesson = (lesson: Lesson) =>\n    setLessons(prev => [...prev, lesson]);\n\n  const updateLesson = (lesson: Lesson) =>\n    setLessons(prev => prev.map(l => (l.id === lesson.id ? lesson : l)));\n\n  const removeLesson = (id: string) =>\n    setLessons(prev => prev.filter(l => l.id !== id));\n\n  const getIndicatorColor = (lesson: Lesson) => {\n    const ratio = lesson.absences / lesson.required;\n    if (ratio <= 1 / 3) return 'green';\n    if (ratio <= 2 / 3) return 'orange';\n    if (ratio < 1) return 'red';\n    return 'black';\n  };\n\n  return { lessons, addLesson, updateLesson, removeLesson, getIndicatorColor };\n}\n"],"mappings":";AAAA;AACA,SAASA,QAAQ,EAAEC,SAAS,QAAQ,OAAO;AAc3C;AACA;AACA;AACA;AACA,OAAO,SAASC,YAAYA,CAACC,QAAgB,EAAE;EAAAC,EAAA;EAC7C,MAAMC,UAAU,GAAG,aAAaF,QAAQ,EAAE;;EAE1C;EACA,MAAM,CAACG,OAAO,EAAEC,UAAU,CAAC,GAAGP,QAAQ,CAAW,MAAM;IACrD,IAAI;MACF,MAAMQ,GAAG,GAAGC,YAAY,CAACC,OAAO,CAACL,UAAU,CAAC;MAC5C,OAAOG,GAAG,GAAGG,IAAI,CAACC,KAAK,CAACJ,GAAG,CAAC,GAAG,EAAE;IACnC,CAAC,CAAC,MAAM;MACN,OAAO,EAAE;IACX;EACF,CAAC,CAAC;;EAEF;EACAP,SAAS,CAAC,MAAM;IACdQ,YAAY,CAACI,OAAO,CAACR,UAAU,EAAEM,IAAI,CAACG,SAAS,CAACR,OAAO,CAAC,CAAC;EAC3D,CAAC,EAAE,CAACA,OAAO,EAAED,UAAU,CAAC,CAAC;;EAEzB;EACAJ,SAAS,CAAC,MAAM;IACd,IAAI;MACF,MAAMO,GAAG,GAAGC,YAAY,CAACC,OAAO,CAACL,UAAU,CAAC;MAC5CE,UAAU,CAACC,GAAG,GAAGG,IAAI,CAACC,KAAK,CAACJ,GAAG,CAAC,GAAG,EAAE,CAAC;IACxC,CAAC,CAAC,MAAM;MACND,UAAU,CAAC,EAAE,CAAC;IAChB;EACF,CAAC,EAAE,CAACF,UAAU,CAAC,CAAC;EAEhB,MAAMU,SAAS,GAAIC,MAAc,IAC/BT,UAAU,CAACU,IAAI,IAAI,CAAC,GAAGA,IAAI,EAAED,MAAM,CAAC,CAAC;EAEvC,MAAME,YAAY,GAAIF,MAAc,IAClCT,UAAU,CAACU,IAAI,IAAIA,IAAI,CAACE,GAAG,CAACC,CAAC,IAAKA,CAAC,CAACC,EAAE,KAAKL,MAAM,CAACK,EAAE,GAAGL,MAAM,GAAGI,CAAE,CAAC,CAAC;EAEtE,MAAME,YAAY,GAAID,EAAU,IAC9Bd,UAAU,CAACU,IAAI,IAAIA,IAAI,CAACM,MAAM,CAACH,CAAC,IAAIA,CAAC,CAACC,EAAE,KAAKA,EAAE,CAAC,CAAC;EAEnD,MAAMG,iBAAiB,GAAIR,MAAc,IAAK;IAC5C,MAAMS,KAAK,GAAGT,MAAM,CAACU,QAAQ,GAAGV,MAAM,CAACW,QAAQ;IAC/C,IAAIF,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,OAAO,OAAO;IAClC,IAAIA,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,OAAO,QAAQ;IACnC,IAAIA,KAAK,GAAG,CAAC,EAAE,OAAO,KAAK;IAC3B,OAAO,OAAO;EAChB,CAAC;EAED,OAAO;IAAEnB,OAAO;IAAES,SAAS;IAAEG,YAAY;IAAEI,YAAY;IAAEE;EAAkB,CAAC;AAC9E;AAACpB,EAAA,CA9CeF,YAAY","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}