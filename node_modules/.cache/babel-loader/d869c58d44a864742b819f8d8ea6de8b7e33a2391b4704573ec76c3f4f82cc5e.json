{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useState, useEffect } from 'react';\n/**\n * 按学期单独读写课程数据的 Hook \n * 会从旧的 'timetable' Key 迁移至 'timetable-{semester}'（仅首次）\n */\nexport function useTimetable(semester) {\n  _s();\n  const storageKey = `timetable-${semester}`;\n\n  // 初始 state：优先从新 Key 读；若无，则尝试从旧 Key 迁移\n  const [lessons, setLessons] = useState(() => {\n    try {\n      const rawNew = localStorage.getItem(storageKey);\n      if (rawNew) {\n        return JSON.parse(rawNew);\n      }\n      // 旧版用的 'timetable' Key\n      const rawOld = localStorage.getItem('timetable');\n      if (rawOld) {\n        // 把旧数据存入新 Key\n        localStorage.setItem(storageKey, rawOld);\n        // （可选）删除旧 Key\n        // localStorage.removeItem('timetable');\n        return JSON.parse(rawOld);\n      }\n      return [];\n    } catch {\n      return [];\n    }\n  });\n\n  // lessons 或 storageKey 变动时写回对应 Key\n  useEffect(() => {\n    localStorage.setItem(storageKey, JSON.stringify(lessons));\n  }, [lessons, storageKey]);\n\n  // 当 storageKey（即 semester）改变时，从新的 Key 重新加载\n  useEffect(() => {\n    try {\n      const raw = localStorage.getItem(storageKey);\n      setLessons(raw ? JSON.parse(raw) : []);\n    } catch {\n      setLessons([]);\n    }\n  }, [storageKey]);\n  const addLesson = lesson => setLessons(prev => [...prev, lesson]);\n  const updateLesson = lesson => setLessons(prev => prev.map(l => l.id === lesson.id ? lesson : l));\n  const removeLesson = id => setLessons(prev => prev.filter(l => l.id !== id));\n  const getIndicatorColor = lesson => {\n    const ratio = lesson.absences / lesson.required;\n    if (ratio <= 1 / 3) return 'green';\n    if (ratio <= 2 / 3) return 'orange';\n    if (ratio < 1) return 'red';\n    return 'black';\n  };\n  return {\n    lessons,\n    addLesson,\n    updateLesson,\n    removeLesson,\n    getIndicatorColor\n  };\n}\n_s(useTimetable, \"RQUiH6NQEwP4Cnous8vubMCg6wg=\");","map":{"version":3,"names":["useState","useEffect","useTimetable","semester","_s","storageKey","lessons","setLessons","rawNew","localStorage","getItem","JSON","parse","rawOld","setItem","stringify","raw","addLesson","lesson","prev","updateLesson","map","l","id","removeLesson","filter","getIndicatorColor","ratio","absences","required"],"sources":["/Users/wangzhenfei/Projects/attendance-timetable-web/src/hooks/useTimetable.ts"],"sourcesContent":["import { useState, useEffect } from 'react';\n\nexport type Lesson = {\n  id: string;\n  weekday: 0 | 1 | 2 | 3 | 4;      // 月～金\n  period: 1 | 2 | 3 | 4 | 5 | 6;    // 1限～6限\n  title: string;\n  professor: string;\n  room: string;\n  required: number;\n  color: string;\n  absences: number;\n};\n\n/**\n * 按学期单独读写课程数据的 Hook \n * 会从旧的 'timetable' Key 迁移至 'timetable-{semester}'（仅首次）\n */\nexport function useTimetable(semester: string) {\n  const storageKey = `timetable-${semester}`;\n\n  // 初始 state：优先从新 Key 读；若无，则尝试从旧 Key 迁移\n  const [lessons, setLessons] = useState<Lesson[]>(() => {\n    try {\n      const rawNew = localStorage.getItem(storageKey);\n      if (rawNew) {\n        return JSON.parse(rawNew);\n      }\n      // 旧版用的 'timetable' Key\n      const rawOld = localStorage.getItem('timetable');\n      if (rawOld) {\n        // 把旧数据存入新 Key\n        localStorage.setItem(storageKey, rawOld);\n        // （可选）删除旧 Key\n        // localStorage.removeItem('timetable');\n        return JSON.parse(rawOld);\n      }\n      return [];\n    } catch {\n      return [];\n    }\n  });\n\n  // lessons 或 storageKey 变动时写回对应 Key\n  useEffect(() => {\n    localStorage.setItem(storageKey, JSON.stringify(lessons));\n  }, [lessons, storageKey]);\n\n  // 当 storageKey（即 semester）改变时，从新的 Key 重新加载\n  useEffect(() => {\n    try {\n      const raw = localStorage.getItem(storageKey);\n      setLessons(raw ? JSON.parse(raw) : []);\n    } catch {\n      setLessons([]);\n    }\n  }, [storageKey]);\n\n  const addLesson = (lesson: Lesson) =>\n    setLessons(prev => [...prev, lesson]);\n\n  const updateLesson = (lesson: Lesson) =>\n    setLessons(prev => prev.map(l => (l.id === lesson.id ? lesson : l)));\n\n  const removeLesson = (id: string) =>\n    setLessons(prev => prev.filter(l => l.id !== id));\n\n  const getIndicatorColor = (lesson: Lesson) => {\n    const ratio = lesson.absences / lesson.required;\n    if (ratio <= 1 / 3) return 'green';\n    if (ratio <= 2 / 3) return 'orange';\n    if (ratio < 1) return 'red';\n    return 'black';\n  };\n\n  return { lessons, addLesson, updateLesson, removeLesson, getIndicatorColor };\n}\n"],"mappings":";AAAA,SAASA,QAAQ,EAAEC,SAAS,QAAQ,OAAO;AAc3C;AACA;AACA;AACA;AACA,OAAO,SAASC,YAAYA,CAACC,QAAgB,EAAE;EAAAC,EAAA;EAC7C,MAAMC,UAAU,GAAG,aAAaF,QAAQ,EAAE;;EAE1C;EACA,MAAM,CAACG,OAAO,EAAEC,UAAU,CAAC,GAAGP,QAAQ,CAAW,MAAM;IACrD,IAAI;MACF,MAAMQ,MAAM,GAAGC,YAAY,CAACC,OAAO,CAACL,UAAU,CAAC;MAC/C,IAAIG,MAAM,EAAE;QACV,OAAOG,IAAI,CAACC,KAAK,CAACJ,MAAM,CAAC;MAC3B;MACA;MACA,MAAMK,MAAM,GAAGJ,YAAY,CAACC,OAAO,CAAC,WAAW,CAAC;MAChD,IAAIG,MAAM,EAAE;QACV;QACAJ,YAAY,CAACK,OAAO,CAACT,UAAU,EAAEQ,MAAM,CAAC;QACxC;QACA;QACA,OAAOF,IAAI,CAACC,KAAK,CAACC,MAAM,CAAC;MAC3B;MACA,OAAO,EAAE;IACX,CAAC,CAAC,MAAM;MACN,OAAO,EAAE;IACX;EACF,CAAC,CAAC;;EAEF;EACAZ,SAAS,CAAC,MAAM;IACdQ,YAAY,CAACK,OAAO,CAACT,UAAU,EAAEM,IAAI,CAACI,SAAS,CAACT,OAAO,CAAC,CAAC;EAC3D,CAAC,EAAE,CAACA,OAAO,EAAED,UAAU,CAAC,CAAC;;EAEzB;EACAJ,SAAS,CAAC,MAAM;IACd,IAAI;MACF,MAAMe,GAAG,GAAGP,YAAY,CAACC,OAAO,CAACL,UAAU,CAAC;MAC5CE,UAAU,CAACS,GAAG,GAAGL,IAAI,CAACC,KAAK,CAACI,GAAG,CAAC,GAAG,EAAE,CAAC;IACxC,CAAC,CAAC,MAAM;MACNT,UAAU,CAAC,EAAE,CAAC;IAChB;EACF,CAAC,EAAE,CAACF,UAAU,CAAC,CAAC;EAEhB,MAAMY,SAAS,GAAIC,MAAc,IAC/BX,UAAU,CAACY,IAAI,IAAI,CAAC,GAAGA,IAAI,EAAED,MAAM,CAAC,CAAC;EAEvC,MAAME,YAAY,GAAIF,MAAc,IAClCX,UAAU,CAACY,IAAI,IAAIA,IAAI,CAACE,GAAG,CAACC,CAAC,IAAKA,CAAC,CAACC,EAAE,KAAKL,MAAM,CAACK,EAAE,GAAGL,MAAM,GAAGI,CAAE,CAAC,CAAC;EAEtE,MAAME,YAAY,GAAID,EAAU,IAC9BhB,UAAU,CAACY,IAAI,IAAIA,IAAI,CAACM,MAAM,CAACH,CAAC,IAAIA,CAAC,CAACC,EAAE,KAAKA,EAAE,CAAC,CAAC;EAEnD,MAAMG,iBAAiB,GAAIR,MAAc,IAAK;IAC5C,MAAMS,KAAK,GAAGT,MAAM,CAACU,QAAQ,GAAGV,MAAM,CAACW,QAAQ;IAC/C,IAAIF,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,OAAO,OAAO;IAClC,IAAIA,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,OAAO,QAAQ;IACnC,IAAIA,KAAK,GAAG,CAAC,EAAE,OAAO,KAAK;IAC3B,OAAO,OAAO;EAChB,CAAC;EAED,OAAO;IAAErB,OAAO;IAAEW,SAAS;IAAEG,YAAY;IAAEI,YAAY;IAAEE;EAAkB,CAAC;AAC9E;AAACtB,EAAA,CA1DeF,YAAY","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}